<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Tracker with Trending</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f4f4f9;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  #searchBar {
    padding: 8px;
    margin-bottom: 15px;
    width: 50%;
    border-radius: 4px;
    border: 1px solid #ccc;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  .grid-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
  }

  form {
    display: flex;
    flex-direction: column;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 300px; /* short form width */
  }

  label {
    margin: 5px 0 2px;
  }

  input, select, button {
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  button {
    cursor: pointer;
    background: #4CAF50;
    color: white;
    border: none;
    transition: 0.2s;
  }

  button:hover {
    background: #45a049;
  }

  .counts, .trending {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 300px;
  }

  .counts h3, .trending h3 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .counts p, .trending p {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 4px 0;
    cursor: pointer;
  }

  .badge {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
  }

  #exportBtn {
    margin-top: 10px;
    padding: 8px;
    border-radius: 4px;
    border: none;
    background-color: #2196F3;
    color: white;
    cursor: pointer;
  }

  #exportBtn:hover {
    background-color: #1976D2;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  table th, table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  table th {
    background: #f0f0f0;
  }

  table td button {
    margin-right: 5px;
    padding: 5px 8px;
    font-size: 12px;
  }

  /* Tag colors */
  .tag-basecamp-feature { background-color: #FFD700; padding: 2px 6px; border-radius: 4px; }
  .tag-basecamp-support { background-color: #87CEEB; padding: 2px 6px; border-radius: 4px; }
  .tag-rfp { background-color: #FF8C00; padding: 2px 6px; border-radius: 4px; }
  .tag-slack-tech { background-color: #FF69B4; padding: 2px 6px; border-radius: 4px; }
  .tag-linear-asks { background-color: #90EE90; padding: 2px 6px; border-radius: 4px; }
  .tag-linear-rfp { background-color: #BA55D3; padding: 2px 6px; border-radius: 4px; }

  /* Row background colors (faint) */
  .row-basecamp-feature { background-color: #fff8dc; }
  .row-basecamp-support { background-color: #e0f7ff; }
  .row-rfp { background-color: #ffe5b4; }
  .row-slack-tech { background-color: #ffdcf0; }
  .row-linear-asks { background-color: #e0ffe0; }
  .row-linear-rfp { background-color: #e6ccff; }

  .completed {
    background-color: #c8e6c9 !important;
  }
</style>
</head>
<body>

<h1>Data Tracker</h1>
<input type="text" id="searchBar" placeholder="Search by Name or Tag">

<div class="grid-container">
  <form id="dataForm">
    <label for="name">Name:</label>
    <input type="text" id="name" required>

    <label for="tags">Tags:</label>
    <select id="tags" required>
      <option value="">Select Tag</option>
      <option value="Basecamp - Feature Requests">Basecamp - Feature Requests</option>
      <option value="Basecamp - Support Triage">Basecamp - Support Triage</option>
      <option value="RFP">RFP</option>
      <option value="Slack #Tech">Slack #Tech</option>
      <option value="Linear - ASKS">Linear - ASKS</option>
      <option value="Linear - RFP">Linear - RFP</option>
    </select>

    <label for="ticketUrl">Ticket URL:</label>
    <input type="url" id="ticketUrl" required>

    <label for="date">Date:</label>
    <input type="date" id="date" required>

    <label>
      <input type="checkbox" id="completed"> Completed
    </label>

    <button type="submit">Add Entry</button>
    <button type="button" id="exportBtn">Export Data</button>
  </form>

  <div class="trending" id="trendingTable">
    <h3>Trending Tickets</h3>
  </div>

  <div class="counts" id="tagCounts">
    <h3>Tag Counts</h3>
  </div>
</div>

<table id="dataTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Tags</th>
      <th>Ticket URL</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const dateInput = document.getElementById('date');
  const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth() + 1).padStart(2, '0');
const dd = String(today.getDate()).padStart(2, '0');
dateInput.value = `${yyyy}-${mm}-${dd}`;


  const form = document.getElementById('dataForm');
  const dataTable = document.getElementById('dataTable').querySelector('tbody');
  const tagCountsDiv = document.getElementById('tagCounts');
  const trendingDiv = document.getElementById('trendingTable');
  const searchBar = document.getElementById('searchBar');
  const exportBtn = document.getElementById('exportBtn');

  const TAGS = [
    "Basecamp - Feature Requests",
    "Basecamp - Support Triage",
    "RFP",
    "Slack #Tech",
    "Linear - ASKS",
    "Linear - RFP"
  ];

  const tagClassMap = {
    "Basecamp - Feature Requests": "tag-basecamp-feature",
    "Basecamp - Support Triage": "tag-basecamp-support",
    "RFP": "tag-rfp",
    "Slack #Tech": "tag-slack-tech",
    "Linear - ASKS": "tag-linear-asks",
    "Linear - RFP": "tag-linear-rfp"
  };

  const rowClassMap = {
    "Basecamp - Feature Requests": "row-basecamp-feature",
    "Basecamp - Support Triage": "row-basecamp-support",
    "RFP": "row-rfp",
    "Slack #Tech": "row-slack-tech",
    "Linear - ASKS": "row-linear-asks",
    "Linear - RFP": "row-linear-rfp"
  };

  const tagColorMap = {
    "Basecamp - Feature Requests": "#FFD700",
    "Basecamp - Support Triage": "#87CEEB",
    "RFP": "#FF8C00",
    "Slack #Tech": "#FF69B4",
    "Linear - ASKS": "#90EE90",
    "Linear - RFP": "#BA55D3"
  };

  let data = JSON.parse(localStorage.getItem('dataEntries')) || [];

  function renderTable(filter='') {
    dataTable.innerHTML = '';
    data.forEach((entry, index) => {
      if (
        entry.name.toLowerCase().includes(filter.toLowerCase()) ||
        entry.tags.toLowerCase().includes(filter.toLowerCase())
      ) {
        const row = document.createElement('tr');
        if (entry.completed) {
          row.classList.add('completed');
        } else {
          row.classList.add(rowClassMap[entry.tags] || '');
        }
        row.innerHTML = `
          <td>${entry.name}</td>
          <td><span class="${tagClassMap[entry.tags] || ''}">${entry.tags}</span></td>
          <td><a href="${entry.ticketUrl}" target="_blank">${entry.ticketUrl}</a></td>
          <td>${entry.date}</td>
          <td>
            <button onclick="editEntry(${index})">Edit</button>
            <button onclick="deleteEntry(${index})">Delete</button>
          </td>
        `;
        dataTable.appendChild(row);
      }
    });
  }

  function renderCounts() {
    const counts = {};
    TAGS.forEach(tag => counts[tag] = 0);

    data.forEach(entry => {
      if (counts[entry.tags] !== undefined) counts[entry.tags]++;
    });

    tagCountsDiv.innerHTML = '<h3>Tag Counts</h3>';
    let total = 0;
    TAGS.forEach(tag => {
      const count = counts[tag];
      total += count;
      const p = document.createElement('p');
      const badge = `<span class="badge" style="background:${tagColorMap[tag]}"></span>`;
      p.innerHTML = `${badge}<span>${tag}</span><span>${count}</span>`;
      tagCountsDiv.appendChild(p);
    });
    const totalP = document.createElement('p');
    totalP.style.fontWeight = 'bold';
    totalP.innerHTML = `<span>Total</span><span>${total}</span>`;
    tagCountsDiv.appendChild(totalP);
  }

  function renderTrending() {
    trendingDiv.innerHTML = '<h3>Trending Tickets</h3>';
    const keywordCounts = {};

    data.forEach(entry => {
      const text = entry.name.toLowerCase(); // only Name column
      const words = text.match(/\b\w+\b/g);
      if (!words) return;
      words.forEach(word => {
        if (word.length <= 2) return;
        keywordCounts[word] = (keywordCounts[word] || 0) + 1;
      });
    });

    const trending = Object.entries(keywordCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5);

    trending.forEach(([keyword, count]) => {
      const p = document.createElement('p');
      p.innerHTML = `<span>${keyword}</span><span>${count}</span>`;
      p.addEventListener('click', () => {
        renderTable(keyword);
      });
      trendingDiv.appendChild(p);
    });
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const entry = {
      name: document.getElementById('name').value,
      tags: document.getElementById('tags').value,
      ticketUrl: document.getElementById('ticketUrl').value,
      date: document.getElementById('date').value || today,
      completed: document.getElementById('completed').checked
    };
    data.push(entry);
    localStorage.setItem('dataEntries', JSON.stringify(data));
    renderTable(searchBar.value);
    renderCounts();
    renderTrending();
    form.reset();
    dateInput.value = today;
  });

  window.editEntry = function(index) {
    const entry = data[index];
    document.getElementById('name').value = entry.name;
    document.getElementById('tags').value = entry.tags;
    document.getElementById('ticketUrl').value = entry.ticketUrl;
    document.getElementById('date').value = entry.date || today;
    document.getElementById('completed').checked = entry.completed;

    data.splice(index, 1);
    localStorage.setItem('dataEntries', JSON.stringify(data));
    renderTable(searchBar.value);
    renderCounts();
    renderTrending();
  };

  window.deleteEntry = function(index) {
    if (confirm('Are you sure you want to delete this entry?')) {
      data.splice(index, 1);
      localStorage.setItem('dataEntries', JSON.stringify(data));
      renderTable(searchBar.value);
      renderCounts();
      renderTrending();
    }
  };

  searchBar.addEventListener('input', () => {
    renderTable(searchBar.value);
    renderTrending();
  });

  exportBtn.addEventListener('click', () => {
    if (data.length === 0) {
      alert('No data to export!');
      return;
    }
    const csvRows = [];
    const headers = ['Name', 'Tags', 'Ticket URL', 'Date', 'Completed'];
    csvRows.push(headers.join(','));
    data.forEach(entry => {
      const row = [entry.name, entry.tags, entry.ticketUrl, entry.date, entry.completed ? 'Yes' : 'No'];
      csvRows.push(row.map(v => `"${v}"`).join(','));
    });
    const csvString = csvRows.join('\n');
    const blob = new Blob([csvString], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'data_tracker_export.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  renderTable();
  renderCounts();
  renderTrending();
});
</script>

</body>
</html>
